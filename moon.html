<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moon Day Checker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      background-color: #f4f4f4;
      padding: 20px;
      margin: 0;
    }
    .container {
      padding: 20px;
    }
    .moon-days {
      margin-top: 20px;
    }
    .error {
      color: red;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    ul li {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <h1>Moon Day ㅇㅇㅇㅇecker</h1>
  <div class="container">
    <p id="yearDisplay"></p>
    <div class="moon-days" id="moonDays">
      <!-- Moon days will be displayed here -->
    </div>
  </div>

  <script>
    const serviceKey = "2iaROfIsgWz4c2VRC3EyV8QBvrUurWFf4Qo06ZpA8lM163O7pkn89xI6R1o6vaU2JvvPGU/iV76ogJX55hRGjw=="; // KASI API 키를 여기에 입력하세요
    const currentYear = new Date().getFullYear(); // 현재 연도 자동 감지
   const apiUrl = `http://apis.data.go.kr/B090041/openapi/service/LunPhInfoService/getLunPhInfo?ServiceKey=${serviceKey}&solYear=${currentYear}&numOfRows=100`;

    const yearDisplay = document.getElementById('yearDisplay');
    const moonDaysContainer = document.getElementById('moonDays');

    yearDisplay.textContent = `${currentYear} Moon Days`;

    async function fetchMoonDays() {
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) {
          throw new Error('Failed to fetch data');
        }

        const textData = await response.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(textData, 'application/xml');

        const items = xmlDoc.getElementsByTagName('item');
        if (items.length === 0) {
          moonDaysContainer.innerHTML = '<p class="error">No data available for the current year.</p>';
          return;
        }

        let newMoonsHtml = '<h3>New Moons</h3><ul>';
        let fullMoonsHtml = '<h3>Full Moons</h3><ul>';

        for (let i = 0; i < items.length; i++) {
          const lunAge = parseFloat(items[i].getElementsByTagName('lunAge')[0].textContent);
          const solDate = items[i].getElementsByTagName('solDate')[0].textContent; // yyyyMMdd
          const dayOfWeek = getDayOfWeek(solDate);
          const formattedDate = formatDate(solDate);

          if (lunAge === 0) {
            // 신월
            newMoonsHtml += `<li>${formattedDate} (${dayOfWeek})</li>`;
          } else if (lunAge === 15) {
            // 보름달
            fullMoonsHtml += `<li>${formattedDate} (${dayOfWeek})</li>`;
          }
        }

        newMoonsHtml += '</ul>';
        fullMoonsHtml += '</ul>';
        moonDaysContainer.innerHTML = newMoonsHtml + fullMoonsHtml;
      } catch (error) {
        console.error('Error fetching Moon Day data:', error);
        moonDaysContainer.innerHTML = '<p class="error">Failed to fetch Moon Day data. Please check your API key or try again later.</p>';
      }
    }

    // 날짜 포맷 함수 (yyyyMMdd → MM월 dd일)
    function formatDate(yyyymmdd) {
      const year = yyyymmdd.slice(0, 4);
      const month = yyyymmdd.slice(4, 6);
      const day = yyyymmdd.slice(6, 8);
      return `${month}월 ${day}일`;
    }

    // 요일 계산 함수
    function getDayOfWeek(yyyymmdd) {
      const year = yyyymmdd.slice(0, 4);
      const month = yyyymmdd.slice(4, 6) - 1; // JavaScript의 월은 0부터 시작
      const day = yyyymmdd.slice(6, 8);
      const date = new Date(year, month, day);
      const days = ['일', '월', '화', '수', '목', '금', '토'];
      return days[date.getDay()];
    }

    // 페이지 로드 시 Moon Day 데이터 가져오기
    fetchMoonDays();
  </script>
</body>
</html>
